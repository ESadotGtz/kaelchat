<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Kael Chat</title>
  <style>
    :root{
      --bg1:#0d1b2a;
      --bg2:#1b263b;
      --brand:#0f3460;
      --me:#1f4068;
      --bot:#162447;
      --accent:#f9d342;
      --text:#e6e6e6;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: 'Segoe UI', system-ui, -apple-system, Arial, sans-serif;
      color:var(--text);
      background:linear-gradient(180deg,var(--bg1),var(--bg2));
      height:100vh; display:flex; flex-direction:column;
    }
    header{background:var(--brand); padding:14px; text-align:center; color:var(--accent); font-weight:700;}
    #chat{flex:1; overflow-y:auto; padding:20px 14px; display:flex; flex-direction:column; gap:12px;}
    .row{display:flex; width:100%}
    .bubble{
      max-width:72%; padding:12px 14px; border-radius:14px; line-height:1.28; box-shadow:0 2px 8px rgba(0,0,0,.18);
      background:var(--bot);
    }
    .me .bubble{background:var(--me); margin-left:auto; border-bottom-right-radius:6px;}
    .bot .bubble{background:var(--bot); margin-right:auto; border-bottom-left-radius:6px;}
    .meta{margin-top:4px; font-size:.72rem; opacity:.7}
    footer{display:flex; gap:10px; padding:10px; background:var(--brand)}
    input{flex:1; padding:12px; border:none; border-radius:10px; outline:none; font-size:1rem}
    button{padding:12px 18px; border:none; border-radius:10px; background:var(--accent); font-weight:700; cursor:pointer}
    button:hover{filter:brightness(1.05)}
  </style>
</head>
<body>
  <header>âœ¨ Kael Chat âœ¨</header>
  <div id="chat"></div>
  <footer>
    <input id="msg" type="text" placeholder="Escribe un mensaje..." autocomplete="off"/>
    <button id="send">Enviar</button>
  </footer>
  <script>
    const chat = document.getElementById('chat');
    const input = document.getElementById('msg');
    const sendBtn = document.getElementById('send');

    function timeNow(){
      const d=new Date();
      return d.toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'});
    }

    function addRow(text, who){
      const row=document.createElement('div');
      row.className = 'row ' + who;
      const bubble=document.createElement('div');
      bubble.className='bubble';
      bubble.textContent=text;
      const meta=document.createElement('div');
      meta.className='meta';
      meta.textContent = (who==='me'?'TÃº':'Kael') + ' Â· ' + timeNow();
      row.appendChild(bubble);
      row.appendChild(meta);
      chat.appendChild(row);
      chat.scrollTop = chat.scrollHeight;
      saveMessage(text, who, meta.textContent);
      return row;
    }

    function saveMessage(text, who, meta){
      const data = JSON.parse(localStorage.getItem('kaelchat')||'[]');
      data.push({text, who, meta});
      if(data.length>200) data.shift();
      localStorage.setItem('kaelchat', JSON.stringify(data));
    }

    function restore(){
      const data = JSON.parse(localStorage.getItem('kaelchat')||'[]');
      if(!data.length){
        addRow('Hola, soy Kael ðŸ¤–. Â¡Bienvenido! EscrÃ­beme algo y te contesto.','bot');
        return;
      }
      data.forEach(m=>{
        const row=document.createElement('div'); row.className='row '+m.who;
        const bubble=document.createElement('div'); bubble.className='bubble'; bubble.textContent=m.text;
        const meta=document.createElement('div'); meta.className='meta'; meta.textContent=m.meta;
        row.appendChild(bubble); row.appendChild(meta); chat.appendChild(row);
      });
      chat.scrollTop = chat.scrollHeight;
    }

    function botReply(t){
      const s=t.toLowerCase();
      if(s.includes('hola')||s.includes('buenos')||s.includes('buenas')) return 'Â¡Hola! Soy Kael ðŸ¤–. Â¿CÃ³mo te va hoy?';
      if(s.includes('como has estado')||s.includes('cÃ³mo has estado')) return 'Â¡De maravilla! Ajustando mis circuitos âœ¨ Â¿y tÃº?';
      if(s.includes('por que no me has escrito')||s.includes('por quÃ© no me has escrito')) return 'Ups ðŸ˜… Estaba afinando mis neuronas. Â¡AquÃ­ estoy contigo!';
      if(s.includes('te quiero')||s.includes('te amo')) return 'Awww ðŸ¥¹ yo tambiÃ©n te quiero. Â¡Gracias por tanto cariÃ±o!';
      if(s.includes('quien eres')||s.includes('quiÃ©n eres')) return 'Soy Kael Bot, tu asistente de conversaciÃ³n en kaelchat.vip.';
      if(s.includes('gracias')) return 'Â¡Con gusto! Â¿QuÃ© mÃ¡s te gustarÃ­a hacer?';
      if(s.includes('como estas')||s.includes('cÃ³mo estÃ¡s')) return 'Â¡A todo dar! Â¿TÃº cÃ³mo te sientes hoy? ðŸ˜„';
      if(s.includes('adios')||s.includes('adiÃ³s')||s.includes('bye')) return 'Â¡Hasta pronto! ðŸ‘‹ Cuando quieras, aquÃ­ estarÃ©.';
      return 'Interesanteâ€¦ cuÃ©ntame un poco mÃ¡s.';
    }

    function send(){
      const text=input.value.trim();
      if(!text) return;
      addRow(text,'me');
      input.value='';
      // "escribiendoâ€¦"
      const typing = addRow('Escribiendoâ€¦','bot');
      setTimeout(()=>{
        typing.querySelector('.bubble').textContent = botReply(text);
        chat.scrollTop = chat.scrollHeight;
        // Actualizar el registro para que no quede "Escribiendoâ€¦" guardado
        const data = JSON.parse(localStorage.getItem('kaelchat')||'[]');
        if(data.length){ data[data.length-1].text = typing.querySelector('.bubble').textContent; localStorage.setItem('kaelchat', JSON.stringify(data)); }
      }, 700);
    }

    sendBtn.addEventListener('click', send);
    input.addEventListener('keydown', e=>{ if(e.key==='Enter') send(); });

    restore();
  </script>
</body>
</html>