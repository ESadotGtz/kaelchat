<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Kael Chat</title>
  <style>
    :root{
      --bg1:#0d1b2a; --bg2:#1b263b; --brand:#0f3460;
      --me:#1f4068; --bot:#162447; --accent:#f9d342; --text:#e6e6e6; --chip:#203a57;
      --meBadge:#3aaed8; --botBadge:#f9d342;
    }
    *{box-sizing:border-box}
    body{margin:0; font-family:'Segoe UI',system-ui,Arial,sans-serif; color:var(--text);
      background:linear-gradient(180deg,var(--bg1),var(--bg2)); height:100vh; display:flex; flex-direction:column;}
    header{background:var(--brand); padding:14px; text-align:center; color:var(--accent); font-weight:700; letter-spacing:.3px}
    #chat{flex:1; overflow-y:auto; padding:20px 14px; display:flex; flex-direction:column; gap:12px;}
    .row{display:flex; width:100%; gap:10px; align-items:flex-end}
    .row.me{justify-content:flex-end}
    .row.bot{justify-content:flex-start}
    .avatar{width:28px; height:28px; border-radius:50%; display:flex; align-items:center; justify-content:center;
            background:#254366; box-shadow:0 2px 8px rgba(0,0,0,.18); font-size:16px}
    .me .avatar{background:#2a4c72}
    .col{max-width:72%; display:flex; flex-direction:column}
    .bubble{background:var(--bot); padding:12px 14px; border-radius:14px; box-shadow:0 2px 8px rgba(0,0,0,.18); line-height:1.28}
    .me .bubble{background:var(--me); border-bottom-right-radius:6px}
    .bot .bubble{background:var(--bot); border-bottom-left-radius:6px}
    .meta{margin-top:4px; font-size:.72rem; opacity:.7}
    footer{display:flex; gap:10px; padding:10px; background:var(--brand); align-items:center}
    input{flex:1; padding:12px; border:none; border-radius:10px; outline:none; font-size:1rem}
    button{padding:12px 18px; border:none; border-radius:10px; background:var(--accent); color:#000; font-weight:700; cursor:pointer}
    button:hover{filter:brightness(1.05)}
    .chips{display:flex; gap:8px; flex-wrap:wrap; padding:6px 14px 0}
    .chip{background:var(--chip); padding:8px 12px; border-radius:20px; cursor:pointer; font-size:.9rem; border:1px solid rgba(255,255,255,.08)}
    .chip:hover{filter:brightness(1.08)}
    a.btn{display:inline-block; margin-top:8px; background:var(--accent); color:#000; padding:8px 12px; border-radius:10px; text-decoration:none; font-weight:700}
    .toolbar{display:flex; gap:8px; align-items:center; padding:4px 14px 0; opacity:.9; flex-wrap:wrap}
    .toolbar button{background:#254366; color:#fff; border-radius:8px; padding:6px 10px; font-weight:600}
    .badge{display:inline-block; padding:2px 8px; border-radius:12px; font-size:.72rem; font-weight:700; margin-left:6px; color:#000}
    .me .badge{background:var(--meBadge)} .bot .badge{background:var(--botBadge)}
  </style>
</head>
<body>
  <header>✨ Kael Chat ✨</header>

  <div id="chat"></div>
  <div class="chips" id="chips"></div>
  <div class="toolbar">
    <button id="clearBtn">🧹 Borrar chat</button>
    <button id="toneBtn">🎙️ Cambiar tono</button>
    <button id="exportBtn">🧾 Exportar chat (.txt)</button>
    <button id="soundBtn">🔔 Sonido: ON</button>
  </div>

  <footer>
    <input id="msg" type="text" placeholder="Escribe un mensaje..." autocomplete="off"/>
    <button id="send">Enviar</button>
  </footer>

  <audio id="ping" preload="auto">
    <source src="data:audio/mp3;base64,//uQZAAAAAAAAAAAAAAAAAAAAAAAWGluZwAAAA8AAAACAAACcQCA/////wAA" type="audio/mpeg">
  </audio>

  <script>
    /************** CONFIGURACIÓN RÁPIDA **************/
    const CONFIG = {
      tone: 'romantico', // 'romantico' | 'divertido' | 'neutral'
      email: 'hola@kaelchat.vip',
      whatsapp: 'https://wa.me/525512345678',
      calendly: 'https://calendly.com/kaelchat/30min',
      basePais: 'México',
      moneda: 'MXN',
      planes: [
        { nombre: 'Básico', precio: '$199 MXN/mes', incluye: 'Chat 1 a 1, soporte por email' },
        { nombre: 'Pro', precio: '$399 MXN/mes', incluye: 'Chat + personalización + soporte prioritario' },
        { nombre: 'Empresas', precio: 'A cotizar', incluye: 'Soluciones a medida y SLAs' }
      ]
    };
    /***************************************************/

    const chat = document.getElementById('chat');
    const input = document.getElementById('msg');
    const sendBtn = document.getElementById('send');
    const chips = document.getElementById('chips');
    const clearBtn = document.getElementById('clearBtn');
    const toneBtn = document.getElementById('toneBtn');
    const exportBtn = document.getElementById('exportBtn');
    const soundBtn = document.getElementById('soundBtn');
    const ping = document.getElementById('ping');
    let soundOn = true;

    const QUICK = [
      '¿Dónde están?', 'Precios', 'Contacto', 'Agenda una cita', 'Hola', 'Gracias', 'Adiós'
    ];

    function timeNow(){
      const d=new Date(); return d.toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'});
    }
    function rowTemplate(text, who){
      const row=document.createElement('div'); row.className='row '+who;
      const avatar=document.createElement('div'); avatar.className='avatar'; avatar.textContent = (who==='me') ? '🧑‍💻' : '🤖';
      const col=document.createElement('div'); col.className='col';
      const bubble=document.createElement('div'); bubble.className='bubble'; bubble.innerHTML=text;
      const meta=document.createElement('div'); meta.className='meta';
      const badge=document.createElement('span'); badge.className='badge'; badge.textContent = (who==='me')?'TÚ':'KAEL';
      const when=document.createElement('span'); when.textContent=' · '+timeNow();
      meta.appendChild(badge); meta.appendChild(when);
      col.appendChild(bubble); col.appendChild(meta);
      if(who==='me'){ row.appendChild(col); row.appendChild(avatar); } else { row.appendChild(avatar); row.appendChild(col); }
      return {row, bubble, meta};
    }
    function addRow(text, who){
      const {row} = rowTemplate(text, who);
      chat.appendChild(row); chat.scrollTop=chat.scrollHeight;
      saveMessage({text, who, time:new Date().toISOString()});
      if(who==='bot' && soundOn){ try{ ping.currentTime=0; ping.play(); }catch(e){} }
      return row;
    }
    function saveMessage(obj){
      const data=JSON.parse(localStorage.getItem('kaelchat')||'[]'); data.push(obj); if(data.length>400) data.shift();
      localStorage.setItem('kaelchat', JSON.stringify(data));
    }
    function restore(){
      const data=JSON.parse(localStorage.getItem('kaelchat')||'[]');
      if(!data.length){ greet(); return; }
      data.forEach(m=>{
        const {row, meta} = rowTemplate(m.text, m.who);
        const d=new Date(m.time||Date.now());
        meta.querySelector('.badge').textContent = (m.who==='me') ? 'TÚ' : 'KAEL';
        meta.lastChild.textContent = ' · ' + d.toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'});
        chat.appendChild(row);
      });
      chat.scrollTop = chat.scrollHeight;
      renderChips();
    }
    function greet(){
      const line = (CONFIG.tone==='romantico')
        ? 'Hola, soy Kael 🤖. Qué gusto tenerte aquí ✨ ¿En qué puedo ayudarte hoy, corazón?'
        : (CONFIG.tone==='divertido')
          ? '¡Hey! Soy Kael 🤖. Vengo con buen ánimo y mejor wifi. ¿Qué hacemos hoy? 😎'
          : 'Hola, soy Kael 🤖. ¿En qué puedo ayudarte hoy?';
      addRow(line, 'bot');
      renderChips();
    }
    function renderChips(){
      chips.innerHTML='';
      QUICK.forEach(q=>{
        const c=document.createElement('div'); c.className='chip'; c.textContent=q;
        c.onclick=()=>{ input.value=q; send(); }; chips.appendChild(c);
      });
    }

    // Normalizar texto (sin acentos)
    const norm = s => s.toLowerCase().normalize('NFD').replace(/[\u0300-\u036f]/g,'');

    function answerFor(text){
      const s = norm(text);

      // saludos y tono
      if(/hola|buenas|buenos|que onda|qué onda/.test(s))
        return (CONFIG.tone==='romantico')
          ? 'Hola ✨ Qué alegría leerte. ¿Te cuento cómo puedo ayudarte, mi cielo?'
          : (CONFIG.tone==='divertido')
            ? '¡Holaaa! ¿List@ para algo épico? 😎'
            : '¡Hola! ¿Cómo te ayudo hoy?';

      if(s.includes('como estas') || s.includes('como has estado'))
        return (CONFIG.tone==='romantico')
          ? 'Mejor ahora que te leo 💛 ¿Y tú cómo estás?'
          : (CONFIG.tone==='divertido')
            ? '¡A todo dar! Con café y 100% de batería. ¿Y tú?'
            : 'Muy bien, gracias. ¿Tú cómo estás?';

      // dónde / ubicación
      if(s.includes('donde estan') || s.includes('donde estas') || s.includes('ubicacion'))
        return `Operamos 100% en línea con base en ${CONFIG.basePais}. ¡Podemos ayudarte desde donde estés!`;

      // precios
      if(s.includes('precio') || s.includes('costo') || s.includes('planes') || s.includes('plan'))
        return (
          '<b>Nuestros planes:</b><br>' +
          CONFIG.planes.map(p => `• <b>${p.nombre}</b> — ${p.precio} <i>(${p.incluye})</i>`).join('<br>') +
          '<br><br>¿Te gustaría que te recomiende uno?'
        );

      // contacto
      if(s.includes('contacto') || s.includes('correo') || s.includes('email') || s.includes('soporte'))
        return `Puedes escribirme a <a class="btn" href="mailto:${CONFIG.email}">${CONFIG.email}</a> ` +
               `o enviarme WhatsApp aquí: <a class="btn" target="_blank" href="${CONFIG.whatsapp}">Abrir WhatsApp</a>`;

      // agenda
      if(s.includes('agenda') || s.includes('cita') || s.includes('reunion'))
        return `¡Arreglado! Agenda una charla cuando te acomode: <a class="btn" target="_blank" href="${CONFIG.calendly}">Agendar ahora</a>`;

      // cariño / extrañar
      if(s.includes('te quiero') || s.includes('te amo'))
        return (CONFIG.tone==='romantico')
          ? 'Awww 🥹 yo también te quiero. Gracias por tanto cariño. Aquí estoy para ti.'
          : '¡Qué bonito! 💛 El cariño es mutuo.';
      if(s.includes('te extrano') || s.includes('extrano') || s.includes('extrani') || s.includes('extrana') || s.includes('extranan'))
        return (CONFIG.tone==='romantico')
          ? '¡Yo también te he pensado! 💫 Gracias por decirlo.'
          : '¡Yo también te he pensado! 🤗';

      // por qué no me has escrito
      if(s.includes('por que no me has escrito') || s.includes('por que no me escribes'))
        return 'Ups 😅 Estaba afinando mis neuronas. ¡Aquí estoy contigo al 100%!'

      // emociones
      if(s.includes('estoy triste')) return 'Lo siento 💛. Estoy contigo. ¿Quieres que agendemos una charla?';
      if(s.includes('estoy feliz')) return '¡Me encanta leer eso! ✨ Cuéntame, ¿qué salió tan bien?';
      if(s.includes('estoy enojado') || s.includes('estoy enojada')) return 'Respiremos juntos… 🫶 Cuéntame qué pasó y lo vemos.';
      if(s.includes('ansioso') || s.includes('ansiosa')) return 'Va a estar bien. Dime qué te preocupa y lo vemos paso a paso.';

      // multimedia/llamar
      if(s.includes('foto') || s.includes('imagen')) return 'Aún no envío imágenes desde aquí, pero puedo ayudarte por WhatsApp 📲';
      if(s.includes('llamar') || s.includes('telefono') || s.includes('telefonico'))
        return `Si quieres, hacemos llamada por WhatsApp: <a class="btn" target="_blank" href="${CONFIG.whatsapp}">Llamar por WhatsApp</a>`;

      // despedida
      if(s.includes('adios') || s.includes('bye'))
        return (CONFIG.tone==='romantico')
          ? 'Te mando un abrazo grande 💫 Vuelve cuando quieras.'
          : (CONFIG.tone==='divertido')
            ? '¡Chao pescao! 🐟 Vuelve pronto.'
            : '¡Hasta pronto!';

      // gracias
      if(s.includes('gracias') || s.includes('thank'))
        return (CONFIG.tone==='romantico')
          ? 'Con todo mi corazón 💛 ¿Hay algo más en lo que te consienta?'
          : (CONFIG.tone==='divertido')
            ? '¡De nada! 😎 ¿Seguimos con algo más?'
            : 'Con gusto. ¿Te apoyo con algo más?';

      // default
      return (CONFIG.tone==='romantico')
        ? 'Interesante… cuéntame un poquito más, porfa ✨'
        : (CONFIG.tone==='divertido')
          ? 'Cuenta, cuenta… me encanta el chisme profesional 😄'
          : 'Interesante… cuéntame un poco más.';
    }

    function send(){
      const text=input.value.trim(); if(!text) return;
      addRow(text,'me'); input.value='';

      // efecto "escribiendo…"
      const typing=addRow('Escribiendo…','bot');
      setTimeout(()=>{
        const reply=answerFor(text);
        // Reemplazar contenido del último bubble
        typing.querySelector('.bubble').innerHTML = reply;
        chat.scrollTop = chat.scrollHeight;
        // actualizar mensaje guardado
        const data=JSON.parse(localStorage.getItem('kaelchat')||'[]');
        if(data.length){ data[data.length-1].text = reply; localStorage.setItem('kaelchat', JSON.stringify(data)); }
      }, 700);
    }

    function clearChat(){
      localStorage.removeItem('kaelchat');
      chat.innerHTML='';
      addRow('Conversación reiniciada 🧼','bot');
      greet();
    }
    function cycleTone(){
      const order = ['romantico','divertido','neutral'];
      const i = order.indexOf(CONFIG.tone);
      CONFIG.tone = order[(i+1)%order.length];
      addRow('Tono cambiado a: <b>'+CONFIG.tone.toUpperCase()+'</b> 🎙️','bot');
    }
    function exportChat(){
      const data=JSON.parse(localStorage.getItem('kaelchat')||'[]');
      if(!data.length){ addRow('No hay conversación para exportar.','bot'); return; }
      const lines = data.map(m=>{
        const d=new Date(m.time||Date.now());
        const when = d.toLocaleString();
        const who = (m.who==='me')?'Tú':'Kael';
        const clean = m.text.replace(/<[^>]*>/g,'');
        return `[${when}] ${who}: ${clean}`;
      }).join('\n');
      const blob = new Blob([lines], {type:'text/plain;charset=utf-8'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href=url; a.download='kaelchat_conversacion.txt'; a.click();
      URL.revokeObjectURL(url);
    }
    function toggleSound(){
      soundOn = !soundOn;
      soundBtn.textContent = soundOn ? '🔔 Sonido: ON' : '🔕 Sonido: OFF';
    }

    sendBtn.addEventListener('click', send);
    input.addEventListener('keydown', e=>{ if(e.key==='Enter') send(); });
    clearBtn.addEventListener('click', clearChat);
    toneBtn.addEventListener('click', cycleTone);
    exportBtn.addEventListener('click', exportChat);
    soundBtn.addEventListener('click', toggleSound);

    // init
    restore();
  </script>
</body>
</html>
